---
- name: C·∫•u h√¨nh c∆° b·∫£n cho Raspberry Pi Homelab
  hosts: homelab_pi
  become: yes  # T·ª± ƒë·ªông d√πng sudo (quan tr·ªçng)

  tasks:
    - name: C·∫≠p nh·∫≠t danh s√°ch apt (apt update)
      apt:
        update_cache: yes
        cache_valid_time: 3600 # N·∫øu m·ªõi update trong 1h th√¨ kh√¥ng c·∫ßn update l·∫°i

    - name: C√†i ƒë·∫∑t c√¥ng c·ª• gi√°m s√°t btop
      apt:
        name: btop
        state: present

    - name: C√†i ƒë·∫∑t vim v√† git (ti·ªán th·ªÉ c√†i lu√¥n)
      apt:
        name:
          - vim
          - git
        state: present

    - name: Th√™m l·ªánh t·∫Øt 'pihealth' v√†o .bashrc
      blockinfile:
        path: /home/{{ ansible_user }}/.bashrc
        marker: "# {mark} ANSIBLE MANAGED BLOCK - PIHEALTH"
        block: |
          alias pihealth='echo "---------------------------------"; \
          echo "üî• CPU Temp: $(vcgencmd measure_temp)"; \
          echo "‚ö° Voltage/Throttled: $(vcgencmd get_throttled)"; \
          echo "   (0x0=Perfect, 0x50000=Undervoltage occurred)"; \
          echo "üöÄ Clock Speed: $(vcgencmd measure_clock arm)"; \
          echo "üíæ Memory Split: $(vcgencmd get_mem arm) / $(vcgencmd get_mem gpu)"; \
          echo "---------------------------------";'
